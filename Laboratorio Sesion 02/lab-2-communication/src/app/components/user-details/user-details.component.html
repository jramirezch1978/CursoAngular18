<div class="user-details-container">
  <!-- ğŸ“‹ Header del componente -->
  <div class="details-header">
    <h2>ğŸ‘¤ Detalles del Usuario</h2>
    <p class="component-info">
      <strong>ğŸ”— Sibling Communication:</strong> 
      Este componente recibe datos del usuario seleccionado mediante un Observable compartido
    </p>
  </div>

  <!-- ğŸ‘¤ Contenido principal -->
  @if (selectedUser) {
    <div class="user-content">
      <!-- ğŸ“Š Modo Vista -->
      @if (!editMode) {
        <div class="view-mode">
          <div class="user-card">
            <!-- Avatar y datos bÃ¡sicos -->
            <div class="user-header">
              <div class="user-avatar">{{ selectedUser.avatar }}</div>
              <div class="user-basic-info">
                <h3 class="user-name">{{ selectedUser.name }}</h3>
                <p class="user-email">ğŸ“§ {{ selectedUser.email }}</p>
                <span class="user-status" [class]="getStatusClass()">
                  {{ selectedUser.isActive ? 'ğŸŸ¢ Activo' : 'ğŸ”´ Inactivo' }}
                </span>
              </div>
            </div>

            <!-- InformaciÃ³n detallada -->
            <div class="user-details">
              <div class="detail-row">
                <label>ğŸ†” ID:</label>
                <span>{{ selectedUser.id }}</span>
              </div>
              
              <div class="detail-row">
                <label>ğŸ­ Rol:</label>
                <span class="role-badge" [class]="'role-' + selectedUser.role">
                  {{ getRoleDisplayName(selectedUser.role) }}
                </span>
              </div>
              
              <div class="detail-row">
                <label>ğŸ“… Ãšltimo Login:</label>
                <span>{{ selectedUser.lastLogin | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              
              <div class="detail-row">
                <label>ğŸ—ï¸ Proyectos:</label>
                <span class="projects-count">{{ selectedUser.projects.length }} asignados</span>
              </div>
            </div>

            <!-- Lista de proyectos -->
            <div class="projects-section">
              <h4>ğŸ—ï¸ Proyectos Asignados</h4>
              @if (selectedUser.projects.length > 0) {
                <div class="projects-list">
                  @for (project of selectedUser.projects; track project) {
                    <div class="project-item">
                      <span class="project-name">{{ project }}</span>
                    </div>
                  }
                </div>
              } @else {
                <p class="no-projects">Sin proyectos asignados</p>
              }
            </div>

            <!-- Botones de acciÃ³n -->
            <div class="action-buttons">
              <button 
                class="btn btn-primary" 
                (click)="startEdit()"
                title="Editar informaciÃ³n del usuario">
                âœï¸ Editar
              </button>
              
              <button 
                class="btn" 
                [class]="selectedUser.isActive ? 'btn-warning' : 'btn-success'"
                (click)="toggleUserStatus()"
                [title]="selectedUser.isActive ? 'Desactivar usuario' : 'Activar usuario'">
                {{ selectedUser.isActive ? 'â¸ï¸ Desactivar' : 'â–¶ï¸ Activar' }}
              </button>
            </div>
          </div>
        </div>
      }

      <!-- âœï¸ Modo EdiciÃ³n -->
      @if (editMode) {
        <div class="edit-mode">
          <div class="edit-card">
            <div class="edit-header">
              <h3>âœï¸ Editando Usuario</h3>
              <p>Modifica la informaciÃ³n del usuario seleccionado</p>
            </div>

            <form class="edit-form" (ngSubmit)="saveChanges()">
              <!-- Nombre -->
              <div class="form-group">
                <label for="edit-name">ğŸ‘¤ Nombre Completo</label>
                <input
                  type="text"
                  id="edit-name"
                  [(ngModel)]="editForm.name"
                  name="name"
                  class="form-control"
                  placeholder="Ingresa el nombre completo"
                  required>
              </div>

              <!-- Email -->
              <div class="form-group">
                <label for="edit-email">ğŸ“§ Correo ElectrÃ³nico</label>
                <input
                  type="email"
                  id="edit-email"
                  [(ngModel)]="editForm.email"
                  name="email"
                  class="form-control"
                  placeholder="usuario@provias.gob.pe"
                  required>
              </div>

              <!-- Rol -->
              <div class="form-group">
                <label for="edit-role">ğŸ­ Rol del Usuario</label>
                <select
                  id="edit-role"
                  [(ngModel)]="editForm.role"
                  name="role"
                  class="form-control"
                  required>
                  <option value="">Seleccionar rol...</option>
                  <option [value]="UserRole.ADMIN">{{ getRoleDisplayName(UserRole.ADMIN) }}</option>
                  <option [value]="UserRole.PROJECT_MANAGER">{{ getRoleDisplayName(UserRole.PROJECT_MANAGER) }}</option>
                  <option [value]="UserRole.ENGINEER">{{ getRoleDisplayName(UserRole.ENGINEER) }}</option>
                  <option [value]="UserRole.TECHNICIAN">{{ getRoleDisplayName(UserRole.TECHNICIAN) }}</option>
                </select>
              </div>

              <!-- Botones del formulario -->
              <div class="form-actions">
                <button 
                  type="submit" 
                  class="btn btn-success"
                  [disabled]="!isFormValid()"
                  title="Guardar cambios">
                  ğŸ’¾ Guardar Cambios
                </button>
                
                <button 
                  type="button" 
                  class="btn btn-secondary"
                  (click)="cancelEdit()"
                  title="Cancelar ediciÃ³n">
                  âŒ Cancelar
                </button>
              </div>
            </form>
          </div>
        </div>
      }
    </div>
  } @else {
    <!-- ğŸ“ Estado sin usuario seleccionado -->
    <div class="no-selection">
      <div class="empty-state">
        <div class="empty-icon">ğŸ‘¤</div>
        <h3>Selecciona un Usuario</h3>
        <p>
          Haz clic en cualquier usuario de la lista para ver sus detalles aquÃ­.
          Este es un ejemplo de <strong>comunicaciÃ³n entre componentes hermanos</strong>.
        </p>
        
        <div class="communication-info">
          <h4>ğŸ”— CÃ³mo Funciona la ComunicaciÃ³n</h4>
          <ol>
            <li><strong>UserListComponent</strong> emite cuando un usuario es seleccionado</li>
            <li><strong>UserManagementService</strong> mantiene el estado del usuario seleccionado</li>
            <li><strong>UserDetailsComponent</strong> se suscribe a los cambios via Observable</li>
            <li>Los datos se actualizan automÃ¡ticamente en tiempo real</li>
          </ol>
        </div>
      </div>
    </div>
  }

  <!-- ğŸ“ InformaciÃ³n educativa -->
  <div class="educational-section">
    <h3>ğŸ“ Conceptos Demostrados</h3>
    
    <div class="concepts-grid">
      <div class="concept">
        <h4>ğŸ”— Sibling Communication</h4>
        <p>ComunicaciÃ³n entre componentes hermanos mediante un servicio compartido</p>
        <ul>
          <li>âœ… Observable pattern</li>
          <li>âœ… Estado compartido</li>
          <li>âœ… Reactividad automÃ¡tica</li>
        </ul>
      </div>
      
      <div class="concept">
        <h4>ğŸ“¡ BehaviorSubject</h4>
        <p>Mantiene el Ãºltimo valor emitido y lo envÃ­a a nuevos suscriptores</p>
        <ul>
          <li>âœ… Estado inicial</li>
          <li>âœ… Valor actual siempre disponible</li>
          <li>âœ… MÃºltiples suscriptores</li>
        </ul>
      </div>
      
      <div class="concept">
        <h4>ğŸ“ Two-way Binding</h4>
        <p>Formularios reactivos con [(ngModel)]</p>
        <ul>
          <li>âœ… SincronizaciÃ³n automÃ¡tica</li>
          <li>âœ… ValidaciÃ³n en tiempo real</li>
          <li>âœ… Estado del formulario</li>
        </ul>
      </div>
    </div>
  </div>
</div>