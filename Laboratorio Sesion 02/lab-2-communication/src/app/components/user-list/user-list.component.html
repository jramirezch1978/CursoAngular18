<div class="user-list-container">
  <header class="list-header">
    <h2>ğŸ‘¥ GestiÃ³n de Usuarios PROVIAS</h2>
    <div class="header-stats">
      <span class="stat">
        ğŸ‘¤ Total: {{ users.length }}
      </span>
      <span class="stat">
        âœ… Activos: {{ getActiveUsersCount() }}
      </span>
      @if (selectedUser) {
        <span class="stat selected">
          ğŸ¯ Seleccionado: {{ selectedUser.name }}
        </span>
      }
    </div>
  </header>

  <!-- ğŸ” SecciÃ³n de bÃºsqueda y filtros -->
  <section class="search-filters">
    <h3>ğŸ” BÃºsqueda y Filtros</h3>
    
    <div class="filters-grid">
      <!-- BÃºsqueda por texto -->
      <div class="filter-group">
        <label for="search">ğŸ” Buscar usuario:</label>
        <input 
          type="text" 
          id="search"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="form-control"
          placeholder="Nombre o email...">
      </div>
      
      <!-- Filtro por rol -->
      <div class="filter-group">
        <label for="roleFilter">ğŸ‘” Filtrar por rol:</label>
        <select 
          id="roleFilter"
          (change)="filterByRole($event.target.value || null)"
          class="form-control">
          <option value="">Todos los roles</option>
          <option [value]="UserRole.ADMIN">{{ getRoleDisplayName(UserRole.ADMIN) }}</option>
          <option [value]="UserRole.PROJECT_MANAGER">{{ getRoleDisplayName(UserRole.PROJECT_MANAGER) }}</option>
          <option [value]="UserRole.ENGINEER">{{ getRoleDisplayName(UserRole.ENGINEER) }}</option>
          <option [value]="UserRole.TECHNICIAN">{{ getRoleDisplayName(UserRole.TECHNICIAN) }}</option>
        </select>
      </div>
      
      <!-- Filtro por estado -->
      <div class="filter-group">
        <label for="statusFilter">ğŸ“Š Filtrar por estado:</label>
        <select 
          id="statusFilter"
          (change)="filterByStatus($event.target.value === 'true' ? true : $event.target.value === 'false' ? false : null)"
          class="form-control">
          <option value="">Todos los estados</option>
          <option value="true">Solo activos</option>
          <option value="false">Solo inactivos</option>
        </select>
      </div>
    </div>
    
    @if (hasActiveFilters()) {
      <div class="active-filters">
        <span class="filters-label">Filtros activos:</span>
        <button 
          (click)="clearFilters()" 
          class="btn btn-sm btn-secondary">
          ğŸ§¹ Limpiar filtros
        </button>
      </div>
    }
  </section>

  <!-- ğŸ® Controles principales -->
  <div class="controls">
    <button 
      (click)="toggleAddForm()" 
      class="btn btn-primary">
      {{ showAddForm ? 'âŒ Cancelar' : 'â• Agregar Usuario' }}
    </button>
    
    <button 
      (click)="clearSelection()" 
      class="btn btn-secondary"
      [disabled]="!selectedUser">
      ğŸ—‘ï¸ Limpiar SelecciÃ³n
    </button>
    
    <button 
      (click)="generateTestUsers()" 
      class="btn btn-warning">
      ğŸ² Generar Usuarios de Prueba
    </button>
    
    <button 
      (click)="resetData()" 
      class="btn btn-danger">
      ğŸ”„ Resetear Datos
    </button>
  </div>

  <!-- ğŸ“ Formulario para nuevo usuario -->
  @if (showAddForm) {
    <section class="add-user-form">
      <h3>â• Agregar Nuevo Usuario</h3>
      
      <form (ngSubmit)="addNewUser()" class="user-form">
        <div class="form-group">
          <label for="newUserName">ğŸ‘¤ Nombre completo:</label>
          <input 
            type="text" 
            id="newUserName"
            [(ngModel)]="newUserForm.name"
            name="name"
            class="form-control"
            placeholder="Ej: Juan PÃ©rez GarcÃ­a"
            required>
        </div>

        <div class="form-group">
          <label for="newUserEmail">ğŸ“§ Email corporativo:</label>
          <input 
            type="email" 
            id="newUserEmail"
            [(ngModel)]="newUserForm.email"
            name="email"
            class="form-control"
            placeholder="juan.perez@provias.gob.pe"
            required>
        </div>

        <div class="form-group">
          <label for="newUserRole">ğŸ‘” Rol:</label>
          <select 
            id="newUserRole"
            [(ngModel)]="newUserForm.role"
            name="role"
            class="form-control"
            required>
            <option [value]="UserRole.TECHNICIAN">{{ getRoleDisplayName(UserRole.TECHNICIAN) }}</option>
            <option [value]="UserRole.ENGINEER">{{ getRoleDisplayName(UserRole.ENGINEER) }}</option>
            <option [value]="UserRole.PROJECT_MANAGER">{{ getRoleDisplayName(UserRole.PROJECT_MANAGER) }}</option>
            <option [value]="UserRole.ADMIN">{{ getRoleDisplayName(UserRole.ADMIN) }}</option>
          </select>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-success"
            [disabled]="!isNewUserFormValid()">
            ğŸ’¾ Crear Usuario
          </button>
          
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="toggleAddForm()">
            âŒ Cancelar
          </button>
        </div>
      </form>
    </section>
  }

  <!-- â³ Estado de carga -->
  @if (isLoading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando usuarios...</p>
    </div>
  }

  <!-- ğŸ‘¥ Lista de usuarios -->
  <section class="users-section">
    <h3>ğŸ‘¥ Lista de Usuarios ({{ users.length }})</h3>
    
    @if (users.length === 0) {
      <div class="no-users">
        <h4>ğŸ“­ No hay usuarios que mostrar</h4>
        <p>Los filtros aplicados no coinciden con ningÃºn usuario.</p>
        @if (hasActiveFilters()) {
          <button (click)="clearFilters()" class="btn btn-primary">
            ğŸ§¹ Limpiar filtros
          </button>
        } @else {
          <button (click)="generateTestUsers()" class="btn btn-primary">
            ğŸ² Generar usuarios de prueba
          </button>
        }
      </div>
    } @else {
      <div class="users-grid">
        @for (user of users; track user.id) {
          <app-user-card
            [user]="user"
            [isSelected]="selectedUser?.id === user.id"
            (userSelected)="onUserSelected($event)"
            (userToggleStatus)="onUserToggleStatus($event)"
            (userDelete)="onUserDelete($event)">
          </app-user-card>
        }
      </div>
    }
  </section>

  <!-- ğŸ“¡ Demo de comunicaciÃ³n -->
  <section class="communication-demo">
    <h3>ğŸ”„ Demo de ComunicaciÃ³n entre Componentes</h3>
    <div class="demo-info">
      <div class="communication-type">
        <h4>ğŸ“¤ Parent â†’ Child (@Input)</h4>
        <ul>
          <li>âœ… <code>[user]</code> - Datos del usuario</li>
          <li>âœ… <code>[isSelected]</code> - Estado de selecciÃ³n</li>
        </ul>
      </div>
      
      <div class="communication-type">
        <h4>ğŸ“¥ Child â†’ Parent (@Output)</h4>
        <ul>
          <li>âœ… <code>(userSelected)</code> - Usuario clickeado</li>
          <li>âœ… <code>(userToggleStatus)</code> - Cambio de estado</li>
          <li>âœ… <code>(userDelete)</code> - Solicitud de eliminaciÃ³n</li>
        </ul>
      </div>
      
      <div class="communication-type">
        <h4>ğŸŒ Service Communication</h4>
        <ul>
          <li>âœ… <code>BehaviorSubject</code> - Estado reactivo</li>
          <li>âœ… <code>Observable</code> - Subscripciones</li>
          <li>âœ… ComunicaciÃ³n entre siblings</li>
        </ul>
      </div>
    </div>
  </section>
</div>