<div class="login-container">
  <!-- ğŸ¯ Header de login -->
  <header class="login-header">
    <div class="brand-section">
      <h1 class="brand-title">ğŸ—ï¸ PROVIAS DESCENTRALIZADO</h1>
      <p class="brand-subtitle">Sistema de GestiÃ³n de Infraestructura Vial</p>
      <p class="lab-title">LAB 4: AutenticaciÃ³n y Guards</p>
    </div>
  </header>

  <div class="login-content">
    <!-- ğŸ”‘ Formulario de login -->
    <section class="login-form-section">
      <div class="form-container">
        <h2 class="form-title">ğŸ”‘ Iniciar SesiÃ³n</h2>
        
        @if (errorMessage) {
          <div class="alert alert-error">
            {{ errorMessage }}
          </div>
        }

        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
          <!-- Campo Usuario -->
          <div class="form-group">
            <label for="username" class="form-label">
              ğŸ‘¤ Usuario
            </label>
            <input
              type="text"
              id="username"
              formControlName="username"
              class="form-control"
              [class.valid]="isFieldValid('username')"
              [class.invalid]="isFieldInvalid('username')"
              placeholder="Ingresa tu nombre de usuario"
              autocomplete="username">
            
            @if (isFieldInvalid('username')) {
              <div class="field-error">
                {{ getFieldError('username') }}
              </div>
            }
          </div>

          <!-- Campo ContraseÃ±a -->
          <div class="form-group">
            <label for="password" class="form-label">
              ğŸ”’ ContraseÃ±a
            </label>
            <input
              type="password"
              id="password"
              formControlName="password"
              class="form-control"
              [class.valid]="isFieldValid('password')"
              [class.invalid]="isFieldInvalid('password')"
              placeholder="Ingresa tu contraseÃ±a"
              autocomplete="current-password">
            
            @if (isFieldInvalid('password')) {
              <div class="field-error">
                {{ getFieldError('password') }}
              </div>
            }
          </div>

          <!-- Recordarme -->
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                formControlName="rememberMe"
                class="checkbox-input">
              <span class="checkbox-text">ğŸ”– Recordar mi sesiÃ³n</span>
            </label>
          </div>

          <!-- BotÃ³n de login -->
          <div class="form-actions">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loginForm.invalid || isLoading"
              [class.loading]="isLoading">
              @if (isLoading) {
                <span class="spinner"></span>
                Iniciando sesiÃ³n...
              } @else {
                ğŸ”‘ Iniciar SesiÃ³n
              }
            </button>
          </div>
        </form>

        <!-- Acciones adicionales -->
        <div class="additional-actions">
          <button class="link-btn" (click)="showHelp()">
            â“ Â¿Necesitas ayuda?
          </button>
          <button class="link-btn" (click)="goToPublicArea()">
            ğŸŒ Ãrea pÃºblica
          </button>
        </div>
      </div>
    </section>

    <!-- ğŸ‘¥ Usuarios de demostraciÃ³n -->
    @if (showDemoCredentials) {
      <section class="demo-section">
        <div class="demo-container">
          <div class="demo-header">
            <h3>ğŸ‘¥ Usuarios de DemostraciÃ³n</h3>
            <p>Haz clic en cualquier usuario para usar sus credenciales</p>
          </div>

          <div class="demo-users-grid">
            @for (user of demoUsers; track user.id) {
              <div 
                class="demo-user-card" 
                [class]="getRoleClass(user.role)"
                (click)="useDemoUser(user)">
                
                <div class="user-avatar">{{ user.avatar }}</div>
                <div class="user-info">
                  <h4 class="user-name">{{ user.fullName }}</h4>
                  <p class="user-role">{{ getRoleDisplayName(user.role) }}</p>
                  <p class="user-username">ğŸ‘¤ {{ user.username }}</p>
                </div>
                <div class="quick-actions">
                  <button 
                    class="quick-login-btn"
                    (click)="quickLogin(user.username); $event.stopPropagation()"
                    title="Login automÃ¡tico">
                    âš¡ Login
                  </button>
                </div>
              </div>
            }
          </div>

          <div class="demo-info">
            <h4>ğŸ”§ Funcionalidades por Rol:</h4>
            <div class="roles-info">
              <div class="role-info admin">
                <strong>ğŸ‘¨â€ğŸ’¼ Administrador:</strong>
                <ul>
                  <li>âœ… Acceso completo al sistema</li>
                  <li>âœ… Panel de administraciÃ³n</li>
                  <li>âœ… GestiÃ³n de usuarios y configuraciÃ³n</li>
                </ul>
              </div>
              
              <div class="role-info project-manager">
                <strong>ğŸ‘¨â€ğŸ—ï¸ Jefe de Proyecto:</strong>
                <ul>
                  <li>âœ… GestiÃ³n completa de proyectos</li>
                  <li>âœ… SupervisiÃ³n de equipos</li>
                  <li>âœ… CreaciÃ³n y ediciÃ³n de usuarios</li>
                </ul>
              </div>
              
              <div class="role-info engineer">
                <strong>ğŸ‘©â€ğŸ”§ Ingeniero:</strong>
                <ul>
                  <li>âœ… EdiciÃ³n de proyectos asignados</li>
                  <li>âœ… VisualizaciÃ³n de usuarios</li>
                  <li>âŒ Sin acceso a administraciÃ³n</li>
                </ul>
              </div>
              
              <div class="role-info technician">
                <strong>ğŸ‘¨â€ğŸ’» TÃ©cnico:</strong>
                <ul>
                  <li>âœ… Consulta de informaciÃ³n</li>
                  <li>âœ… VisualizaciÃ³n de proyectos</li>
                  <li>âŒ Sin permisos de ediciÃ³n</li>
                </ul>
              </div>
              
              <div class="role-info guest">
                <strong>ğŸ‘¤ Invitado:</strong>
                <ul>
                  <li>âœ… Solo lectura bÃ¡sica</li>
                  <li>âŒ Acceso muy limitado</li>
                  <li>âŒ Sin gestiÃ³n de datos</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>
    }

    <!-- ğŸ“ InformaciÃ³n educativa -->
    <section class="educational-section">
      <h3>ğŸ“ Conceptos Demostrados - LAB 4</h3>
      
      <div class="concepts-grid">
        <div class="concept">
          <h4>ğŸ” AuthService</h4>
          <ul>
            <li>âœ… AutenticaciÃ³n con localStorage</li>
            <li>âœ… GestiÃ³n de sesiones y tokens</li>
            <li>âœ… Roles y permisos granulares</li>
            <li>âœ… Eventos de seguridad</li>
          </ul>
        </div>
        
        <div class="concept">
          <h4>ğŸ›¡ï¸ Guards</h4>
          <ul>
            <li>âœ… AuthGuard - ProtecciÃ³n de rutas</li>
            <li>âœ… AdminGuard - AutorizaciÃ³n por roles</li>
            <li>âœ… UnsavedChangesGuard - Prevenir pÃ©rdida de datos</li>
            <li>âœ… CanActivate, CanLoad, CanDeactivate</li>
          </ul>
        </div>
        
        <div class="concept">
          <h4>ğŸ”’ Seguridad</h4>
          <ul>
            <li>âœ… Control de acceso granular</li>
            <li>âœ… Timeout de sesiÃ³n automÃ¡tico</li>
            <li>âœ… Bloqueo por intentos fallidos</li>
            <li>âœ… AuditorÃ­a de eventos de seguridad</li>
          </ul>
        </div>
        
        <div class="concept">
          <h4>ğŸ¯ Lazy Loading</h4>
          <ul>
            <li>âœ… MÃ³dulos cargados bajo demanda</li>
            <li>âœ… Guards en rutas lazy</li>
            <li>âœ… OptimizaciÃ³n de rendimiento</li>
            <li>âœ… SeparaciÃ³n de funcionalidades</li>
          </ul>
        </div>
      </div>
    </section>
  </div>

  <!-- ğŸ”½ Toggle demo credentials -->
  <div class="demo-toggle">
    <button 
      class="toggle-btn" 
      (click)="toggleDemoCredentials()">
      {{ showDemoCredentials ? 'ğŸ”¼ Ocultar' : 'ğŸ”½ Mostrar' }} Usuarios Demo
    </button>
  </div>
</div>