<div class="dashboard-container">
  <!-- Header con información del laboratorio -->
  <header class="dashboard-header">
    <h1>📊 Dashboard de Analytics - PROVIAS</h1>
    <p class="subtitle">Demostración de Servicios con Signals y Computed Values</p>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="refreshDashboard()">
        🔄 Actualizar
      </button>
      <button class="btn btn-secondary" (click)="exportData()">
        📤 Exportar
      </button>
      <button class="btn btn-warning" (click)="simulateChanges()">
        🎯 Simular Cambios
      </button>
    </div>
  </header>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-section">
      <div class="spinner"></div>
      <p>Cargando datos del dashboard...</p>
    </div>
  }

  <!-- Métricas Principales (Computed Signals) -->
  <section class="metrics-section">
    <h2>📈 Métricas Reactivas (Computed Signals)</h2>
    <div class="metrics-grid">
      
      <!-- Tasa de Completación -->
      <div class="metric-card completion">
        <div class="metric-icon">✅</div>
        <div class="metric-content">
          <h3>{{ completionRate() }}%</h3>
          <p>Tasa de Completación</p>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="completionRate()"></div>
          </div>
        </div>
      </div>

      <!-- Score de Productividad -->
      <div class="metric-card productivity">
        <div class="metric-icon">🚀</div>
        <div class="metric-content">
          <h3>{{ productivityScore() }}</h3>
          <p>Score de Productividad</p>
          <small>Calculado con signals automáticamente</small>
        </div>
      </div>

      <!-- Nivel de Riesgo -->
      <div class="metric-card risk" [class]="'risk-' + riskLevel().color">
        <div class="metric-icon">⚠️</div>
        <div class="metric-content">
          <h3>{{ riskLevel().level }}</h3>
          <p>Nivel de Riesgo</p>
          <small>Basado en prioridades y vencimientos</small>
        </div>
      </div>

      <!-- Promedio de Horas -->
      <div class="metric-card hours">
        <div class="metric-icon">⏱️</div>
        <div class="metric-content">
          <h3>{{ averageHoursPerTask() }}h</h3>
          <p>Promedio por Tarea</p>
          <small>Estimación automática</small>
        </div>
      </div>

      <!-- Tendencia de Progreso -->
      <div class="metric-card trend">
        <div class="metric-icon">{{ progressTrend().icon }}</div>
        <div class="metric-content">
          <h3>{{ progressTrend().trend }}</h3>
          <p>Tendencia de Progreso</p>
          <small>Análisis de la semana</small>
        </div>
      </div>

    </div>
  </section>

  <!-- Estadísticas Detalladas del Servicio -->
  <section class="detailed-stats">
    <h2>📋 Estadísticas Detalladas (Service Signals)</h2>
    
    <div class="stats-container">
      <!-- Distribución por Estado -->
      <div class="stats-card">
        <h3>Estados de Tareas</h3>
        <div class="status-distribution">
          @for (status of [TaskStatus.PENDING, TaskStatus.IN_PROGRESS, TaskStatus.IN_REVIEW, TaskStatus.COMPLETED, TaskStatus.CANCELLED, TaskStatus.ON_HOLD]; track status) {
            <div class="status-item">
              <div 
                class="status-bar" 
                [style.backgroundColor]="getStatusColor(status)"
                [style.width.%]="statistics().total > 0 ? (statistics().byStatus[status] / statistics().total * 100) : 0">
              </div>
              <span class="status-label">{{ status }}</span>
              <span class="status-count">{{ statistics().byStatus[status] || 0 }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Distribución por Prioridad -->
      <div class="stats-card">
        <h3>Prioridades</h3>
        <div class="priority-distribution">
          @for (priority of [TaskPriority.CRITICAL, TaskPriority.URGENT, TaskPriority.HIGH, TaskPriority.MEDIUM, TaskPriority.LOW]; track priority) {
            <div class="priority-item">
              <div 
                class="priority-indicator"
                [style.backgroundColor]="getPriorityColor(priority)">
              </div>
              <span class="priority-label">{{ priority }}</span>
              <span class="priority-count">{{ statistics().byPriority[priority] || 0 }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Resumen General -->
      <div class="stats-card summary">
        <h3>Resumen General</h3>
        <div class="summary-items">
          <div class="summary-item">
            <span class="label">Total de Tareas:</span>
            <span class="value">{{ statistics().total }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Tareas Vencidas:</span>
            <span class="value overdue">{{ statistics().overdue }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Completadas esta semana:</span>
            <span class="value completed">{{ statistics().completedThisWeek }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Horas estimadas totales:</span>
            <span class="value">{{ statistics().totalEstimatedHours }}h</span>
          </div>
          <div class="summary-item">
            <span class="label">Horas trabajadas:</span>
            <span class="value">{{ statistics().totalActualHours }}h</span>
          </div>
          <div class="summary-item">
            <span class="label">Tiempo promedio completación:</span>
            <span class="value">{{ statistics().averageCompletionTime }} días</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tareas Urgentes -->
  @if (urgentTasks().length > 0) {
    <section class="urgent-section">
      <h2>🚨 Tareas Urgentes (Computed Signal)</h2>
      <div class="urgent-tasks">
        @for (task of urgentTasks(); track task.id) {
          <div class="urgent-task">
            <div class="task-priority" [style.backgroundColor]="getPriorityColor(task.priority)">
              {{ task.priority }}
            </div>
            <div class="task-info">
              <h4>{{ task.title }}</h4>
              <p>{{ task.description }}</p>
              <div class="task-meta">
                <span class="due-date">Vence: {{ task.dueDate | date:'short' }}</span>
                <span class="progress">{{ task.completionPercentage }}% completado</span>
              </div>
            </div>
            <div class="task-status" [style.color]="getStatusColor(task.status)">
              {{ task.status }}
            </div>
          </div>
        }
      </div>
    </section>
  }

  <!-- Sección Educativa -->
  <section class="educational-section">
    <h2>🎓 Conceptos Demostrados en este Dashboard</h2>
    <div class="concepts-grid">
      
      <div class="concept-card">
        <h3>🔧 inject() Function</h3>
        <p>Inyección moderna de dependencias sin constructor</p>
        <code>private readonly taskService = inject(TaskStateService);</code>
      </div>

      <div class="concept-card">
        <h3>📊 Computed Signals</h3>
        <p>Cálculos que se actualizan automáticamente cuando cambian sus dependencias</p>
        <code>completionRate = computed(() => { /* lógica */ });</code>
      </div>

      <div class="concept-card">
        <h3>🔄 Reactive State</h3>
        <p>Estado que se propaga automáticamente a través de la aplicación</p>
        <code>tasks = this.taskService.tasks;</code>
      </div>

      <div class="concept-card">
        <h3>✨ Signal Effects</h3>
        <p>Efectos secundarios que se ejecutan cuando cambian los signals</p>
        <code>effect(() => { /* reacción a cambios */ });</code>
      </div>

      <div class="concept-card">
        <h3>🏪 Service Signals</h3>
        <p>Estado compartido entre componentes usando servicios con signals</p>
        <code>@Injectable({ providedIn: 'root' })</code>
      </div>

      <div class="concept-card">
        <h3>📈 Real-time Updates</h3>
        <p>Actualizaciones en tiempo real sin subscripciones manuales</p>
        <code>// Automático con signals! 🎉</code>
      </div>

    </div>
  </section>

  <!-- Footer con información técnica -->
  <footer class="dashboard-footer">
    <p>💡 <strong>Nota para estudiantes:</strong> Este dashboard demuestra cómo los Signals en Angular proporcionan 
       reactividad automática. Cada vez que cambia el estado en TaskStateService, 
       todas las métricas computadas se actualizan automáticamente sin código adicional.</p>
  </footer>
</div>
