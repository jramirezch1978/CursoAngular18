<div class="dashboard-container">
  <!-- Header con informaciÃ³n del laboratorio -->
  <header class="dashboard-header">
    <h1>ğŸ“Š Dashboard de Analytics - PROVIAS</h1>
    <p class="subtitle">DemostraciÃ³n de Servicios con Signals y Computed Values</p>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="refreshDashboard()">
        ğŸ”„ Actualizar
      </button>
      <button class="btn btn-secondary" (click)="exportData()">
        ğŸ“¤ Exportar
      </button>
      <button class="btn btn-warning" (click)="simulateChanges()">
        ğŸ¯ Simular Cambios
      </button>
    </div>
  </header>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-section">
      <div class="spinner"></div>
      <p>Cargando datos del dashboard...</p>
    </div>
  }

  <!-- MÃ©tricas Principales (Computed Signals) -->
  <section class="metrics-section">
    <h2>ğŸ“ˆ MÃ©tricas Reactivas (Computed Signals)</h2>
    <div class="metrics-grid">
      
      <!-- Tasa de CompletaciÃ³n -->
      <div class="metric-card completion">
        <div class="metric-icon">âœ…</div>
        <div class="metric-content">
          <h3>{{ completionRate() }}%</h3>
          <p>Tasa de CompletaciÃ³n</p>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="completionRate()"></div>
          </div>
        </div>
      </div>

      <!-- Score de Productividad -->
      <div class="metric-card productivity">
        <div class="metric-icon">ğŸš€</div>
        <div class="metric-content">
          <h3>{{ productivityScore() }}</h3>
          <p>Score de Productividad</p>
          <small>Calculado con signals automÃ¡ticamente</small>
        </div>
      </div>

      <!-- Nivel de Riesgo -->
      <div class="metric-card risk" [class]="'risk-' + riskLevel().color">
        <div class="metric-icon">âš ï¸</div>
        <div class="metric-content">
          <h3>{{ riskLevel().level }}</h3>
          <p>Nivel de Riesgo</p>
          <small>Basado en prioridades y vencimientos</small>
        </div>
      </div>

      <!-- Promedio de Horas -->
      <div class="metric-card hours">
        <div class="metric-icon">â±ï¸</div>
        <div class="metric-content">
          <h3>{{ averageHoursPerTask() }}h</h3>
          <p>Promedio por Tarea</p>
          <small>EstimaciÃ³n automÃ¡tica</small>
        </div>
      </div>

      <!-- Tendencia de Progreso -->
      <div class="metric-card trend">
        <div class="metric-icon">{{ progressTrend().icon }}</div>
        <div class="metric-content">
          <h3>{{ progressTrend().trend }}</h3>
          <p>Tendencia de Progreso</p>
          <small>AnÃ¡lisis de la semana</small>
        </div>
      </div>

    </div>
  </section>

  <!-- EstadÃ­sticas Detalladas del Servicio -->
  <section class="detailed-stats">
    <h2>ğŸ“‹ EstadÃ­sticas Detalladas (Service Signals)</h2>
    
    <div class="stats-container">
      <!-- DistribuciÃ³n por Estado -->
      <div class="stats-card">
        <h3>Estados de Tareas</h3>
        <div class="status-distribution">
          @for (status of [TaskStatus.PENDING, TaskStatus.IN_PROGRESS, TaskStatus.IN_REVIEW, TaskStatus.COMPLETED, TaskStatus.CANCELLED, TaskStatus.ON_HOLD]; track status) {
            <div class="status-item">
              <div 
                class="status-bar" 
                [style.backgroundColor]="getStatusColor(status)"
                [style.width.%]="statistics().total > 0 ? (statistics().byStatus[status] / statistics().total * 100) : 0">
              </div>
              <span class="status-label">{{ status }}</span>
              <span class="status-count">{{ statistics().byStatus[status] || 0 }}</span>
            </div>
          }
        </div>
      </div>

      <!-- DistribuciÃ³n por Prioridad -->
      <div class="stats-card">
        <h3>Prioridades</h3>
        <div class="priority-distribution">
          @for (priority of [TaskPriority.CRITICAL, TaskPriority.URGENT, TaskPriority.HIGH, TaskPriority.MEDIUM, TaskPriority.LOW]; track priority) {
            <div class="priority-item">
              <div 
                class="priority-indicator"
                [style.backgroundColor]="getPriorityColor(priority)">
              </div>
              <span class="priority-label">{{ priority }}</span>
              <span class="priority-count">{{ statistics().byPriority[priority] || 0 }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Resumen General -->
      <div class="stats-card summary">
        <h3>Resumen General</h3>
        <div class="summary-items">
          <div class="summary-item">
            <span class="label">Total de Tareas:</span>
            <span class="value">{{ statistics().total }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Tareas Vencidas:</span>
            <span class="value overdue">{{ statistics().overdue }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Completadas esta semana:</span>
            <span class="value completed">{{ statistics().completedThisWeek }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Horas estimadas totales:</span>
            <span class="value">{{ statistics().totalEstimatedHours }}h</span>
          </div>
          <div class="summary-item">
            <span class="label">Horas trabajadas:</span>
            <span class="value">{{ statistics().totalActualHours }}h</span>
          </div>
          <div class="summary-item">
            <span class="label">Tiempo promedio completaciÃ³n:</span>
            <span class="value">{{ statistics().averageCompletionTime }} dÃ­as</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tareas Urgentes -->
  @if (urgentTasks().length > 0) {
    <section class="urgent-section">
      <h2>ğŸš¨ Tareas Urgentes (Computed Signal)</h2>
      <div class="urgent-tasks">
        @for (task of urgentTasks(); track task.id) {
          <div class="urgent-task">
            <div class="task-priority" [style.backgroundColor]="getPriorityColor(task.priority)">
              {{ task.priority }}
            </div>
            <div class="task-info">
              <h4>{{ task.title }}</h4>
              <p>{{ task.description }}</p>
              <div class="task-meta">
                <span class="due-date">Vence: {{ task.dueDate | date:'short' }}</span>
                <span class="progress">{{ task.completionPercentage }}% completado</span>
              </div>
            </div>
            <div class="task-status" [style.color]="getStatusColor(task.status)">
              {{ task.status }}
            </div>
          </div>
        }
      </div>
    </section>
  }

  <!-- SecciÃ³n Educativa -->
  <section class="educational-section">
    <h2>ğŸ“ Conceptos Demostrados en este Dashboard</h2>
    <div class="concepts-grid">
      
      <div class="concept-card">
        <h3>ğŸ”§ inject() Function</h3>
        <p>InyecciÃ³n moderna de dependencias sin constructor</p>
        <code>private readonly taskService = inject(TaskStateService);</code>
      </div>

      <div class="concept-card">
        <h3>ğŸ“Š Computed Signals</h3>
        <p>CÃ¡lculos que se actualizan automÃ¡ticamente cuando cambian sus dependencias</p>
        <code>completionRate = computed(() => { /* lÃ³gica */ });</code>
      </div>

      <div class="concept-card">
        <h3>ğŸ”„ Reactive State</h3>
        <p>Estado que se propaga automÃ¡ticamente a travÃ©s de la aplicaciÃ³n</p>
        <code>tasks = this.taskService.tasks;</code>
      </div>

      <div class="concept-card">
        <h3>âœ¨ Signal Effects</h3>
        <p>Efectos secundarios que se ejecutan cuando cambian los signals</p>
        <code>effect(() => { /* reacciÃ³n a cambios */ });</code>
      </div>

      <div class="concept-card">
        <h3>ğŸª Service Signals</h3>
        <p>Estado compartido entre componentes usando servicios con signals</p>
        <code>@Injectable({ providedIn: 'root' })</code>
      </div>

      <div class="concept-card">
        <h3>ğŸ“ˆ Real-time Updates</h3>
        <p>Actualizaciones en tiempo real sin subscripciones manuales</p>
        <code>// AutomÃ¡tico con signals! ğŸ‰</code>
      </div>

    </div>
  </section>

  <!-- Footer con informaciÃ³n tÃ©cnica -->
  <footer class="dashboard-footer">
    <p>ğŸ’¡ <strong>Nota para estudiantes:</strong> Este dashboard demuestra cÃ³mo los Signals en Angular proporcionan 
       reactividad automÃ¡tica. Cada vez que cambia el estado en TaskStateService, 
       todas las mÃ©tricas computadas se actualizan automÃ¡ticamente sin cÃ³digo adicional.</p>
  </footer>
</div>
