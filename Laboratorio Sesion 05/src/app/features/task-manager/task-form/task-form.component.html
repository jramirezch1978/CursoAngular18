<div class="task-form-container">
  <!-- Header -->
  <header class="form-header">
    <h1>📝 Crear Nueva Tarea - PROVIAS</h1>
    <p class="subtitle">Demostración de Forms Reactivos con Signals e Inject()</p>
    
    <div class="header-actions">
      <button type="button" class="btn btn-info" (click)="logFormValue()">
        📊 Ver Datos Form
      </button>
      <button type="button" class="btn btn-secondary" (click)="fillSampleData()">
        📝 Datos de Ejemplo
      </button>
      <button type="button" class="btn btn-warning" (click)="resetForm()">
        🔄 Limpiar Form
      </button>
    </div>
  </header>

  <!-- Formulario Principal -->
  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
    
    <!-- Información Básica -->
    <section class="form-section">
      <h2>📋 Información Básica</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="title">Título de la Tarea *</label>
          <input 
            type="text" 
            id="title"
            formControlName="title"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('title')"
            placeholder="Ej: Implementar dashboard de métricas">
          @if (isFieldInvalid('title')) {
            <div class="invalid-feedback">
              {{ getFieldError('title') }}
            </div>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="description">Descripción *</label>
          <textarea 
            id="description"
            formControlName="description"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('description')"
            rows="4"
            placeholder="Describe detalladamente lo que debe realizarse en esta tarea..."></textarea>
          @if (isFieldInvalid('description')) {
            <div class="invalid-feedback">
              {{ getFieldError('description') }}
            </div>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="priority">Prioridad *</label>
          <div class="priority-selector">
            @for (priority of priorities; track priority) {
              <label class="priority-option" [style.border-color]="getPriorityColor(priority)">
                <input 
                  type="radio" 
                  formControlName="priority" 
                  [value]="priority"
                  class="priority-radio">
                <span class="priority-content">
                  <span class="priority-icon">{{ getPriorityIcon(priority) }}</span>
                  <span class="priority-label">{{ priority }}</span>
                </span>
              </label>
            }
          </div>
          @if (isFieldInvalid('priority')) {
            <div class="invalid-feedback">
              {{ getFieldError('priority') }}
            </div>
          }
        </div>
      </div>
    </section>

    <!-- Asignación y Proyecto -->
    <section class="form-section">
      <h2>👥 Asignación y Proyecto</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="assigneeId">Asignado a *</label>
          <select 
            id="assigneeId"
            formControlName="assigneeId"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('assigneeId')">
            <option value="">Selecciona un desarrollador</option>
            @for (assignee of assignees; track assignee.id) {
              <option [value]="assignee.id">{{ assignee.name }}</option>
            }
          </select>
          @if (isFieldInvalid('assigneeId')) {
            <div class="invalid-feedback">
              {{ getFieldError('assigneeId') }}
            </div>
          }
        </div>

        <div class="form-group">
          <label for="projectId">Proyecto *</label>
          <select 
            id="projectId"
            formControlName="projectId"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('projectId')">
            <option value="">Selecciona un proyecto</option>
            @for (project of projects; track project) {
              <option [value]="project">{{ project }} - Proyecto PROVIAS</option>
            }
          </select>
          @if (isFieldInvalid('projectId')) {
            <div class="invalid-feedback">
              {{ getFieldError('projectId') }}
            </div>
          }
        </div>
      </div>
    </section>

    <!-- Planificación -->
    <section class="form-section">
      <h2>📅 Planificación</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="dueDate">Fecha de Vencimiento *</label>
          <input 
            type="date" 
            id="dueDate"
            formControlName="dueDate"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('dueDate')">
          @if (isFieldInvalid('dueDate')) {
            <div class="invalid-feedback">
              {{ getFieldError('dueDate') }}
            </div>
          }
        </div>

        <div class="form-group">
          <label for="estimatedHours">Horas Estimadas *</label>
          <input 
            type="number" 
            id="estimatedHours"
            formControlName="estimatedHours"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('estimatedHours')"
            min="1"
            max="200"
            step="0.5"
            placeholder="8">
          @if (isFieldInvalid('estimatedHours')) {
            <div class="invalid-feedback">
              {{ getFieldError('estimatedHours') }}
            </div>
          }
          <small class="form-text">Estimación en horas (1-200)</small>
        </div>
      </div>
    </section>

    <!-- Opciones Avanzadas -->
    <section class="form-section">
      <div class="section-header">
        <h2>⚙️ Opciones Avanzadas</h2>
        <button 
          type="button" 
          class="btn btn-link"
          (click)="toggleAdvanced()">
          {{ showAdvanced() ? '🔼 Ocultar' : '🔽 Mostrar' }}
        </button>
      </div>

      @if (showAdvanced()) {
        <div class="advanced-options">
          <div class="form-row">
            <div class="form-group">
              <label for="tags">Etiquetas</label>
              <input 
                type="text" 
                id="tags"
                formControlName="tags"
                class="form-control"
                placeholder="frontend, angular, signals (separadas por comas)">
              <small class="form-text">Separar múltiples etiquetas con comas</small>
            </div>
          </div>
        </div>
      }
    </section>

    <!-- Estado del Formulario (Educativo) -->
    <section class="form-status">
      <h3>📊 Estado del Formulario (Solo Educativo)</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="status-label">Válido:</span>
          <span class="status-value" [class.valid]="taskForm.valid" [class.invalid]="!taskForm.valid">
            {{ taskForm.valid ? '✅ Sí' : '❌ No' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">Tocado:</span>
          <span class="status-value">{{ taskForm.touched ? '✅ Sí' : '❌ No' }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Sucio:</span>
          <span class="status-value">{{ taskForm.dirty ? '✅ Sí' : '❌ No' }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">Enviando:</span>
          <span class="status-value">{{ isSubmitting() ? '⏳ Sí' : '❌ No' }}</span>
        </div>
      </div>
    </section>

    <!-- Acciones del Formulario -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="resetForm()"
        [disabled]="isSubmitting()">
        🔄 Cancelar
      </button>
      
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="!taskForm.valid || isSubmitting()">
        @if (isSubmitting()) {
          <span class="spinner"></span>
          Creando Tarea...
        } @else {
          ✅ Crear Tarea
        }
      </button>
    </div>
  </form>

  <!-- Sección Educativa -->
  <section class="educational-section">
    <h2>🎓 Conceptos Demostrados</h2>
    <div class="concepts-grid">
      
      <div class="concept-card">
        <h3>📝 Reactive Forms</h3>
        <p>Formularios reactivos con validaciones y estado controlado</p>
        <code>this.fb.group({ /* configuración */ })</code>
      </div>

      <div class="concept-card">
        <h3>💉 inject() con FormBuilder</h3>
        <p>Inyección moderna de FormBuilder sin constructor</p>
        <code>private readonly fb = inject(FormBuilder);</code>
      </div>

      <div class="concept-card">
        <h3>📊 Signals en Forms</h3>
        <p>Manejo de estado del formulario con signals</p>
        <code>isSubmitting = signal(false);</code>
      </div>

      <div class="concept-card">
        <h3>✅ Validaciones Custom</h3>
        <p>Validaciones síncronas y mensajes de error dinámicos</p>
        <code>[Validators.required, Validators.minLength(5)]</code>
      </div>

      <div class="concept-card">
        <h3>🔄 Estado Reactivo</h3>
        <p>Integración del formulario con servicios usando signals</p>
        <code>this.taskService.addTask(createTaskDto);</code>
      </div>

      <div class="concept-card">
        <h3>🎯 UX Avanzada</h3>
        <p>Feedback visual, estados de carga y notificaciones</p>
        <code>this.notificationService.success(/* mensaje */);</code>
      </div>

    </div>
  </section>

  <!-- Footer -->
  <footer class="form-footer">
    <p>💡 <strong>Nota para estudiantes:</strong> Este formulario demuestra la integración de Forms Reactivos 
       con Signals, la nueva función inject(), y cómo mantener el estado sincronizado con servicios. 
       Observa cómo las validaciones y notificaciones trabajan juntas para una UX fluida.</p>
  </footer>
</div>
