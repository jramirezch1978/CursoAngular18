<!-- LAB4: Caching y OptimizaciÃ³n - Dashboard Principal -->
<div class="lab4-container">
  <!-- Header -->
  <header class="app-header">
    <div class="header-content">
      <h1>âš¡ PROVIAS - LAB4: Caching & OptimizaciÃ³n</h1>
      <p class="subtitle">Sistema optimizado con cache inteligente y bÃºsqueda eficiente</p>
    </div>
    
    <!-- Performance Metrics -->
    <div class="metrics-bar">
      <div class="metric">
        <span class="metric-value">{{ cacheHitRate }}%</span>
        <span class="metric-label">Cache Hit Rate</span>
      </div>
      <div class="metric">
        <span class="metric-value">{{ avgResponseTime }}ms</span>
        <span class="metric-label">Avg Response Time</span>
      </div>
      <div class="metric">
        <span class="metric-value">{{ totalCached }}</span>
        <span class="metric-label">Cached Items</span>
      </div>
      <div class="metric">
        <span class="metric-value">{{ savedRequests }}</span>
        <span class="metric-label">Saved Requests</span>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Cache Demo Section -->
    <section class="cache-section">
      <h2>ğŸ—‚ï¸ Cache Management Demo</h2>
      
      <div class="cache-controls">
        <button class="btn btn-primary" (click)="testCacheHit()">
          ğŸ¯ Test Cache Hit
        </button>
        <button class="btn btn-secondary" (click)="testCacheMiss()">
          âŒ Test Cache Miss
        </button>
        <button class="btn btn-warning" (click)="clearCache()">
          ğŸ§¹ Clear Cache
        </button>
        <button class="btn btn-info" (click)="viewCacheStats()">
          ğŸ“Š View Stats
        </button>
      </div>

      <!-- Cache Visualization -->
      <div class="cache-visualization">
        <h3>ğŸ“ˆ Cache Performance</h3>
        <div class="performance-grid">
          <div class="perf-item">
            <div class="perf-icon">ğŸ’¾</div>
            <h4>Memory Usage</h4>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="memoryUsage"></div>
            </div>
            <p>{{ memoryUsage }}% used</p>
          </div>
          <div class="perf-item">
            <div class="perf-icon">âš¡</div>
            <h4>Speed Improvement</h4>
            <div class="speed-indicator">
              <span class="speed-value">{{ speedImprovement }}x</span>
              <span class="speed-label">faster with cache</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Optimized Search Section -->
    <section class="search-section">
      <h2>ğŸ” Optimized Search Demo</h2>
      
      <div class="search-container">
        <div class="search-box">
          <input 
            type="text" 
            class="search-input"
            placeholder="Try searching for products..."
            [(ngModel)]="searchTerm"
            (input)="onSearchInput($event)"
          >
          <span class="search-icon">ğŸ”</span>
        </div>
        
        <div class="search-info">
          <p>âœ¨ Features:</p>
          <ul>
            <li>â±ï¸ Debounced input (300ms)</li>
            <li>ğŸ”„ Automatic request cancellation</li>
            <li>ğŸ’¾ Cached search results</li>
            <li>ğŸš« Duplicate prevention</li>
          </ul>
        </div>
      </div>

      <!-- Search Results -->
      <div class="search-results" *ngIf="searchResults.length > 0">
        <h3>Search Results ({{ searchResults.length }})</h3>
        <div class="results-grid">
          <div class="result-item" *ngFor="let item of searchResults">
            <span class="result-name">{{ item.name }}</span>
            <span class="result-price">${{ item.price }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Features Grid -->
    <section class="features-section">
      <h2>ğŸš€ Optimization Features</h2>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">ğŸ’¾</div>
          <h3>In-Memory Cache</h3>
          <p>Smart caching with TTL and LRU eviction</p>
          <ul>
            <li>âœ“ Configurable TTL</li>
            <li>âœ“ Size limits</li>
            <li>âœ“ Auto cleanup</li>
          </ul>
        </div>

        <div class="feature-card">
          <div class="feature-icon">ğŸ”</div>
          <h3>Search Optimization</h3>
          <p>Efficient search with multiple optimizations</p>
          <ul>
            <li>âœ“ Debouncing</li>
            <li>âœ“ Deduplication</li>
            <li>âœ“ Request cancellation</li>
          </ul>
        </div>

        <div class="feature-card">
          <div class="feature-icon">ğŸ“Š</div>
          <h3>Performance Metrics</h3>
          <p>Real-time monitoring and analytics</p>
          <ul>
            <li>âœ“ Hit/Miss ratio</li>
            <li>âœ“ Response times</li>
            <li>âœ“ Memory usage</li>
          </ul>
        </div>

        <div class="feature-card">
          <div class="feature-icon">âš¡</div>
          <h3>Request Deduplication</h3>
          <p>Prevents duplicate simultaneous requests</p>
          <ul>
            <li>âœ“ ShareReplay</li>
            <li>âœ“ Request merging</li>
            <li>âœ“ Smart queuing</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Console Output -->
    <section class="console-section">
      <h2>ğŸ“ Live Console Output</h2>
      <div class="console-container">
        <div class="console-output-wrapper">
          @if (consoleOutput.length === 0) {
            <div class="console-empty">
              <p>ğŸ‘† Click the buttons above to see cache in action!</p>
            </div>
          }
          @for (log of consoleOutput; track $index) {
            <div class="console-line" [class]="'console-' + log.type">
              {{ log.message }}
            </div>
          }
        </div>
      </div>
      
      <div class="console-tips">
        <h3>ğŸ’¡ Tips:</h3>
        <ul>
          <li>Click "Test Cache Hit" multiple times to fill the cache</li>
          <li>Watch the Memory Usage % increase as cache fills</li>
          <li>Notice the response time difference between cache and network</li>
          <li>Use "View Stats" to see detailed metrics</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <p>LAB4: Caching & OptimizaciÃ³n - PROVIAS Descentralizado | Angular v18</p>
  </footer>
</div>

<router-outlet></router-outlet>
