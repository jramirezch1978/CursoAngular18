<div class="lab2-container">
  <header class="lab-header">
    <h1>ğŸŒŠ LAB 2: RXJS Y OBSERVABLES</h1>
    <p class="subtitle">PROVIAS DESCENTRALIZADO - Angular v18</p>
    <p class="instructor">Instructor: Ing. Jhonny Alexander Ramirez Chiroque</p>
  </header>

  <nav class="navigation-tabs">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'intro'"
      (click)="setActiveTab('intro')">
      ğŸ“š IntroducciÃ³n RxJS
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'subjects'"
      (click)="setActiveTab('subjects')">
      ğŸ­ Subjects Demo
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'transform'"
      (click)="setActiveTab('transform')">
      ğŸ”„ Operadores TransformaciÃ³n
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'combination'"
      (click)="setActiveTab('combination')">
      ğŸ”— Operadores CombinaciÃ³n
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'errors'"
      (click)="setActiveTab('errors')">
      ğŸ›¡ï¸ Manejo de Errores
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'search'"
      (click)="setActiveTab('search')">
      ğŸ” BÃºsqueda Reactiva
    </button>
  </nav>

  <main class="lab-content">
    <!-- IntroducciÃ³n a RxJS -->
    <section *ngIf="activeTab === 'intro'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ¯ Bienvenidos al Mundo RxJS</h2>
        <blockquote>
          "Bienvenidos al mundo de RxJS, donde los datos fluyen como rÃ­os que podemos controlar con precisiÃ³n."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
        
        <div class="comparison-table-container">
          <h3>ğŸ“Š Observable vs Promise</h3>
          <table class="comparison-table">
            <thead>
              <tr>
                <th>CaracterÃ­stica</th>
                <th>Promise</th>
                <th>Observable</th>
                <th>Ventaja Observable</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Valores</strong></td>
                <td>Uno solo</td>
                <td class="highlight">MÃºltiples en el tiempo</td>
                <td>Streams de datos</td>
              </tr>
              <tr>
                <td><strong>Cancelable</strong></td>
                <td class="no">âŒ No</td>
                <td class="yes">âœ… SÃ­</td>
                <td>Eficiencia pura</td>
              </tr>
              <tr>
                <td><strong>Lazy</strong></td>
                <td class="no">âŒ Ejecuta inmediatamente</td>
                <td class="yes">âœ… Solo al suscribirse</td>
                <td>Como Netflix</td>
              </tr>
              <tr>
                <td><strong>Operadores</strong></td>
                <td>then/catch bÃ¡sicos</td>
                <td class="highlight">100+ especializados</td>
                <td>Superpoder total</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="concept-box">
          <h3>ğŸ§  Conceptos Fundamentales</h3>
          <div class="concept-grid">
            <div class="concept-card">
              <h4>ğŸ”¥ Hot vs Cold</h4>
              <p><strong>Cold:</strong> Se ejecuta al suscribirse (HTTP)<br>
              <strong>Hot:</strong> Ya ejecutÃ¡ndose (eventos)</p>
            </div>
            <div class="concept-card">
              <h4>ğŸ¼ Event Loop</h4>
              <p>Director de orquesta que coordina todos los streams</p>
            </div>
            <div class="concept-card">
              <h4>ğŸŒŠ Streams</h4>
              <p>Flujos continuos de datos que se pueden transformar</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Subjects Demo -->
    <section *ngIf="activeTab === 'subjects'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ­ PatrÃ³n Observer - Subjects Demo</h2>
        <blockquote>
          "Un Subject es fascinante porque es Observable y Observer simultÃ¡neamente. Es como ser locutor y oyente de radio al mismo tiempo."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
      </div>

      <div class="subjects-grid">
        <!-- BehaviorSubject -->
        <div class="subject-demo-card">
          <h3>ğŸ§  BehaviorSubject (Usuario Actual)</h3>
          <p><strong>Con memoria:</strong> Nuevas suscripciones reciben el Ãºltimo valor</p>
          <button class="demo-button primary" (click)="setRandomUser()">
            Cambiar Usuario
          </button>
          <div class="result-box" *ngIf="currentUser">
            <strong>Usuario actual:</strong>
            <pre>{{ currentUser | json }}</pre>
          </div>
        </div>

        <!-- ReplaySubject -->
        <div class="subject-demo-card">
          <h3>ğŸ“š ReplaySubject (Historial)</h3>
          <p><strong>Memoria mÃºltiple:</strong> Mantiene los Ãºltimos 3 mensajes</p>
          <div class="message-input">
            <input 
              [(ngModel)]="newMessage" 
              placeholder="Nuevo mensaje"
              (keydown.enter)="addMessage()">
            <button class="demo-button secondary" (click)="addMessage()">
              Enviar
            </button>
          </div>
          <div class="messages-list">
            <div *ngFor="let msg of messages" class="message-item">
              {{ msg }}
            </div>
          </div>
        </div>

        <!-- Subject Simple -->
        <div class="subject-demo-card">
          <h3>ğŸ“¡ Subject Simple (Broadcasting)</h3>
          <p><strong>Multicast:</strong> Emite a todos los suscriptores</p>
          <button class="demo-button broadcast" (click)="broadcastData()">
            Broadcast Data
          </button>
          <div class="broadcast-status">
            Suscriptores activos: {{ activeSubscriptions }}
          </div>
        </div>
      </div>
    </section>

    <!-- Operadores de TransformaciÃ³n -->
    <section *ngIf="activeTab === 'transform'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ”„ Operadores de TransformaciÃ³n</h2>
        <blockquote>
          "Los operadores de transformaciÃ³n son donde RxJS muestra su verdadero poder. Son sus pinceles para pintar con datos."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
      </div>

      <div class="transform-demo">
        <button class="demo-button transform" (click)="testTransformOperators()">
          ğŸ¨ Ejecutar Transformaciones
        </button>
        
        <div class="operators-results">
          <div *ngFor="let result of transformResults" class="operator-result">
            <h4>{{ result.operator }}</h4>
            <pre>{{ result.data | json }}</pre>
          </div>
        </div>

        <div class="operators-explanation">
          <h3>ğŸ§° Operadores Explicados</h3>
          <div class="operators-grid">
            <div class="operator-card">
              <h4>ğŸ—ºï¸ MAP</h4>
              <p><strong>TransformaciÃ³n pura:</strong> Como lÃ­nea de ensamblaje, cada elemento pasa por transformaciÃ³n especÃ­fica</p>
            </div>
            <div class="operator-card">
              <h4>ğŸšª FILTER</h4>
              <p><strong>GuardiÃ¡n de calidad:</strong> Como portero de club exclusivo, solo entran los que cumplen criterios</p>
            </div>
            <div class="operator-card">
              <h4>ğŸ” TAP</h4>
              <p><strong>Efectos secundarios:</strong> Como cÃ¡maras de seguridad, observan sin interferir</p>
            </div>
            <div class="operator-card">
              <h4>ğŸ”„ SWITCHMAP</h4>
              <p><strong>Magia para bÃºsquedas:</strong> Cancela anterior y comienza nueva automÃ¡ticamente</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Operadores de CombinaciÃ³n -->
    <section *ngIf="activeTab === 'combination'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ”— Operadores de CombinaciÃ³n</h2>
        <blockquote>
          "Los operadores de combinaciÃ³n son sus herramientas para orquestar mÃºltiples flujos de datos."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
      </div>

      <div class="combination-demo">
        <div class="combination-buttons">
          <button class="demo-button combine" (click)="testCombineLatest()">
            ğŸ”„ CombineLatest
          </button>
          <button class="demo-button fork" (click)="testForkJoin()">
            ğŸ´ ForkJoin
          </button>
          <button class="demo-button merge" (click)="testMerge()">
            ğŸŒŠ Merge
          </button>
          <button class="demo-button zip" (click)="testZip()">
            ğŸ¤ Zip
          </button>
        </div>
        
        <div class="combination-results">
          <div *ngFor="let result of combinationResults" class="combination-result">
            <h4>{{ result.type }}</h4>
            <pre>{{ result.data | json }}</pre>
          </div>
        </div>

        <div class="operators-explanation">
          <h3>ğŸ¼ Combinaciones Explicadas</h3>
          <div class="operators-grid">
            <div class="operator-card">
              <h4>ğŸ”„ COMBINELATEST</h4>
              <p><strong>SincronizaciÃ³n continua:</strong> Dashboard en tiempo real que se actualiza cuando cualquier fuente cambia</p>
            </div>
            <div class="operator-card">
              <h4>ğŸ´ FORKJOIN</h4>
              <p><strong>Todo listo definitivo:</strong> Espera a que todos lleguen antes de empezar la reuniÃ³n</p>
            </div>
            <div class="operator-card">
              <h4>ğŸŒŠ MERGE</h4>
              <p><strong>Combinador simple:</strong> MÃºltiples mangueras vertiendo en el mismo tanque</p>
            </div>
            <div class="operator-card">
              <h4>ğŸ¤ ZIP</h4>
              <p><strong>Emparejamiento estricto:</strong> Como parejas de baile, cada uno con su pareja correspondiente</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Manejo de Errores -->
    <section *ngIf="activeTab === 'errors'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ›¡ï¸ Manejo de Errores Profesional</h2>
        <blockquote>
          "El manejo de errores en RxJS es sofisticado y poderoso. Este manejo robusto de errores es lo que separa aplicaciones hobby de aplicaciones profesionales."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
      </div>

      <div class="error-demo">
        <div class="error-buttons">
          <button class="demo-button retry" (click)="testRetry()">
            ğŸ”„ Test Retry
          </button>
          <button class="demo-button timeout" (click)="testTimeout()">
            â° Test Timeout
          </button>
          <button class="demo-button cache" (click)="testCachedData()">
            ğŸ’¾ Test Cache
          </button>
        </div>
        
        <div class="error-log">
          <h4>ğŸ“‹ Log de Operaciones</h4>
          <div class="log-container">
            <div *ngFor="let log of errorLogs" 
                 class="log-entry" 
                 [class.error]="log.type === 'error'">
              [{{ log.time }}] {{ log.message }}
            </div>
          </div>
        </div>

        <div class="error-patterns">
          <h3>ğŸ§° Patrones de Error</h3>
          <div class="patterns-grid">
            <div class="pattern-card">
              <h4>ğŸª¤ CATCHERROR</h4>
              <p><strong>Red de seguridad:</strong> A veces fallar silenciosamente es mejor que fallar ruidosamente</p>
            </div>
            <div class="pattern-card">
              <h4>ğŸ”„ RETRY</h4>
              <p><strong>Persistencia simple:</strong> Como llamar a una puerta varias veces antes de irse</p>
            </div>
            <div class="pattern-card">
              <h4>âš¡ RETRYWHEN</h4>
              <p><strong>Inteligencia aplicada:</strong> Backoff exponencial como protocolo diplomÃ¡tico</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BÃºsqueda Reactiva -->
    <section *ngIf="activeTab === 'search'" class="content-section">
      <div class="theory-box">
        <h2>ğŸ” BÃºsqueda Reactiva Inteligente</h2>
        <blockquote>
          "switchMap es magia para bÃºsquedas. Cada vez que el usuario escribe, cancela la bÃºsqueda anterior y comienza una nueva. Con debounceTime esperan 300ms despuÃ©s de que el usuario deja de escribir."
          <footer>- Ing. Jhonny Ramirez</footer>
        </blockquote>
      </div>

      <div class="search-demo">
        <div class="search-container">
          <input 
            class="search-input"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch($event)"
            placeholder="ğŸ” Buscar usuarios de PROVIAS... (min 2 caracteres)"
            autocomplete="off">
          
          <div class="search-status">
            {{ searchStatus }}
          </div>
        </div>
        
        <div class="search-results" *ngIf="searchResults.length > 0">
          <h4>ğŸ“‹ Resultados de bÃºsqueda:</h4>
          <div class="results-grid">
            <div *ngFor="let user of searchResults" class="user-card">
              <div class="user-info">
                <strong>{{ user.name }}</strong>
                <span class="email">{{ user.email }}</span>
                <span class="role" [class]="user.role">{{ user.role }}</span>
              </div>
              <div class="user-status" [class.active]="user.isActive">
                {{ user.isActive ? 'ğŸŸ¢ Activo' : 'ğŸ”´ Inactivo' }}
              </div>
            </div>
          </div>
        </div>

        <div class="search-explanation">
          <h3>ğŸ§  CÃ³mo Funciona la Magia</h3>
          <div class="flow-steps">
            <div class="step">
              <span class="step-number">1</span>
              <strong>debounceTime(300)</strong>
              <p>Espera 300ms despuÃ©s de escribir</p>
            </div>
            <div class="arrow">â†’</div>
            <div class="step">
              <span class="step-number">2</span>
              <strong>distinctUntilChanged()</strong>
              <p>Solo busca si el tÃ©rmino cambiÃ³</p>
            </div>
            <div class="arrow">â†’</div>
            <div class="step">
              <span class="step-number">3</span>
              <strong>switchMap()</strong>
              <p>Cancela bÃºsqueda anterior automÃ¡ticamente</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Panel de MÃ©tricas RxJS -->
  <aside class="metrics-panel">
    <h3>ğŸ“Š MÃ©tricas de RxJS</h3>
    <div class="metrics-grid">
      <div class="metric-card">
        <span class="metric-label">Suscripciones Activas</span>
        <span class="metric-value active">{{ activeSubscriptions }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Eventos Emitidos</span>
        <span class="metric-value events">{{ eventsEmitted }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Errores Manejados</span>
        <span class="metric-value errors">{{ errorsHandled }}</span>
      </div>
    </div>
    
    <div class="memory-info">
      <h4>ğŸ§¹ GestiÃ³n de Memoria</h4>
      <p>Auto-cleanup con takeUntil(destroy$)</p>
      <div class="cleanup-status">
        <span class="status-indicator" [class.safe]="activeSubscriptions > 0">
          {{ activeSubscriptions > 0 ? 'âœ… Gestionado' : 'âš ï¸ Sin suscripciones' }}
        </span>
      </div>
    </div>
  </aside>
</div>